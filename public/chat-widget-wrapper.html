<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Chat Widget</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        background: transparent !important;
        overflow: hidden !important;
      }
    </style>
    <style>
      iframe[src*="chat-widget-wrapper"] {
          background: transparent !important;
          background-color: transparent !important;
      }
      </style>
   
    <script>

      const urlParams = new URLSearchParams(window.location.search);


      const tk = urlParams.get("tk") || "";
            let parentOrigin = "";

      window.addEventListener("message", function (event) {
        if (event.data?.type === "PARENT_ORIGIN") {
          parentOrigin = event.data.origin;
          console.log("Parent origin is:", parentOrigin);

          // Load the widget only after we get the parent origin
          loadChatWidget(tk, parentOrigin);
        }
      });

      // fallback in case message is blocked or never arrives
      setTimeout(() => {
        if (!parentOrigin) {
          loadChatWidget(tk, "unknown");
        }
      }, 1000);

      function loadChatWidget(tk, origin) {
        const script = document.createElement("script");
        script.src = "https://connexusaiwidget.pages.dev/chat-widget.js";
        script.setAttribute("tk", tk);
        script.setAttribute("parent-origin", origin); // optional

        script.onload = () => {
          if (!window.__widget_initialized__) {
            try {
              initializeChatWidget({ origin }); // pass origin to your widget if needed
            } catch (e) {
              console.warn("Chat widget failed to initialize:", e);
            }
            window.__widget_initialized__ = true;
          }
        };

        document.head.appendChild(script);
      }

  // // Ask the parent for its origin
  //       window.parent.postMessage("REQUEST_PARENT_ORIGIN", "*");
      
  //       // Listen for the response
  //       window.addEventListener("message", function (event) {
  //         if (event.data?.type === "PARENT_ORIGIN") {
  //           const parentOrigin = event.data.origin;
  //           console.log("Parent origin is:", parentOrigin);
      
  //           // âœ… Now you can use parentOrigin
  //         }
  //       });

  //     //change vocodia-maxoderm-multi-widget
  //     const script = document.createElement("script");
  //     script.src = "https://connexusaiwidget.pages.dev/chat-widget.js";
  //     script.setAttribute("tk", tk);
  //     script.setAttribute("parent-origin", origin); // optional

  //     script.onload = () => {
  //       if (!window.__widget_initialized__) {
  //         try {
  //           initializeChatWidget();
  //         } catch (e) {}
  //         window.__widget_initialized__ = true;
  //       }
  //     };


  //     document.head.appendChild(script);
    </script>
  </head>
  <body>
    <div id="widget-container"></div>
  </body>
</html>